{"version":3,"file":"key-values-property-editor-ui.element-KWLIIKCE.js","sources":["../../../Client/src/propertyeditors/key-values-property-editor-ui.element.ts"],"sourcesContent":["import { css, html, customElement, property, state, query, repeat } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { umbConfirmModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport { UmbPropertyValueChangeEvent } from \"@umbraco-cms/backoffice/property-editor\";\r\n\r\n/*\r\nThis is a work in progress\r\n\r\nWHAT WORKS NOW\r\n* You can add, delete and update items - the save and publish stores to the db and it loads.\r\n* I do check for a new property so that it works to add the first item\r\n\r\nTODO:\r\n1) Sorter\r\n2) Check the key is unique and not null on add (perhaps a nice config option)\r\n3) Maybe a backend property type convertor. - if we use a key value pair then recheck items are unique - what to do if some junk duplicates are there?\r\n4) Style and tidy up\r\n*/\r\n\r\n// todo - should these be here or inside the custom element\r\ntype UmbCommunityKeyValue = {\r\n  key: string;\r\n  value: string;\r\n};\r\ntype ArrayOf<T> = T[];\r\n\r\n@customElement('key-values-property-editor-ui')\r\nexport default class UmbCommunityKeyValuesPropertyEditorUIElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\r\n  @property()\r\n  public value: ArrayOf<UmbCommunityKeyValue> = [];\r\n\r\n  @state()\r\n  private _items: ArrayOf<UmbCommunityKeyValue> = [];\r\n\r\n  @query('#key-value-new-key')\r\n  newNameInp!: HTMLInputElement;\r\n\r\n  @query('#key-value-new-value')\r\n  newValueInp!: HTMLInputElement;\r\n\r\n  // use the connectedCallback as suggested by Jacob Overgaard as this is where the this.value is available and assigned\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    // in connectedCallback the this.value is ready\r\n    this._items = this.value;\r\n  }\r\n\r\n  #onAddRow() {\r\n    const currentInputTyped: UmbCommunityKeyValue = {\r\n      key: this.newNameInp.value,\r\n      value: this.newValueInp.value\r\n    };\r\n\r\n    // check the value is an array, the concatenate o/w create an array with this as the first item\r\n    this._items = Array.isArray(this.value) ? [...this.value, currentInputTyped] : [currentInputTyped];\r\n\r\n    this.newNameInp.value = '';\r\n    this.newValueInp.value = '';\r\n\r\n    this.#updatePropertyEditorValue();\r\n  }\r\n\r\n  #onDelete(index: number) {\r\n    umbConfirmModal(this, { headline: 'Delete?', content: 'Are you sure you want to delete this item?' })\r\n      .then(() => {\r\n        this._items = [...this._items.slice(0, index), ...this._items.slice(index + 1)];\r\n        this.#updatePropertyEditorValue();\r\n      })\r\n      .catch(() => {\r\n        //console.log('Delete cancelled')\r\n      })\r\n  }\r\n\r\n  private _onEditRowValue(e: InputEvent, index: number) {\r\n    let currentItem = this._items[index];\r\n\r\n    const updatedItem: UmbCommunityKeyValue = {\r\n      key: currentItem.key,\r\n      value: (e.target as HTMLInputElement).value\r\n    };\r\n\r\n    this._items = [...this._items.slice(0, index), updatedItem, ...this._items.slice(index + 1)];\r\n\r\n    this.#updatePropertyEditorValue();\r\n  }\r\n\r\n  #updatePropertyEditorValue() {\r\n    this.value = this._items;\r\n    this.dispatchEvent(new UmbPropertyValueChangeEvent());\r\n  }\r\n\r\n  // Prevent valid events from bubbling outside the message element\r\n  #onValid(event: Event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  // Prevent invalid events from bubbling outside the message element\r\n  #onInvalid(event: Event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  renderItemsList() {\r\n    // writes out the list with fields to update\r\n    if (this._items?.length) {\r\n      return html`\r\n      <ul>\r\n        ${repeat(this._items, (item) => item.key, (item, index) => html`\r\n            <li>\r\n              <umb-form-validation-message id=\"validation-message\" @invalid=${this.#onInvalid} @valid=${this.#onValid}>\r\n                <div class=\"wrapper\">\r\n                  <uui-input\r\n                    class=\"kv-input\"\r\n                    type=\"text\"\r\n                    name=\"${index}\"\r\n                    value=\"${item.key}\"\r\n                    required=true\r\n                    required-message=\"A key value is required\"\r\n                    ></uui-input>\r\n                  <uui-input\r\n                    class=\"kv-input\"\r\n                    type=\"text\"\r\n                    name=\"${index}\"\r\n                    value=\"${item.value}\"\r\n                    @input=${(e: InputEvent) => this._onEditRowValue(e, index)}>\r\n                  </uui-input>\r\n                  <uui-button\r\n\t\t\t\t\t\t        compact\r\n\t\t\t\t\t\t        color=\"danger\"\r\n\t\t\t\t\t\t        label=\"remove ${item.key}\"\r\n\t\t\t\t\t\t        look=\"outline\"\r\n\t\t\t\t\t\t        @click=${() => this.#onDelete(index)}>\r\n\t\t\t\t\t\t        <uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t        </uui-button>\r\n                </div>\r\n              </umb-form-validation-message>\r\n            </li> `\r\n      )\r\n        }\r\n      </ul>`;\r\n    } else {\r\n      return html`<span>You don't have any items yet</span>`;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n        ${this.renderItemsList()}\r\n            <hr/>\r\n            <div class=\"wrapper\">\r\n              <uui-input\r\n                  id=\"key-value-new-key\"\r\n                  class=\"kv-input\"\r\n                  label=\"text input\"\r\n                  placeholder=\"key*\"\r\n                  value=\"\"\r\n              >\r\n              </uui-input>\r\n              <uui-input\r\n                  id=\"key-value-new-value\"\r\n                  class=\"kv-input\"\r\n                  label=\"text input\"\r\n                  value=\"\"\r\n                  placeholder=\"value\"\r\n              >\r\n              </uui-input>\r\n              <uui-button\r\n                  id=\"add-row-button\"\r\n                  class=\"kv-input\"\r\n                  look=\"primary\"\r\n                  label=\"Add item\"\r\n                  @click=${this.#onAddRow}\r\n              >\r\n                  Add item\r\n              </uui-button>\r\n            </div>\r\n        `;\r\n  }\r\n\r\n  static styles = [\r\n    css`\r\n      .wrapper {\r\n          margin-top: 10px;\r\n          display: flex;\r\n          gap: 10px;\r\n      }\r\n      .kv-input {\r\n        flex: 1;\r\n      }\r\n      ul {\r\n        list-style: none;\r\n        padding-inline-start: 0;\r\n      }\r\n      `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'key-values-property-editor-ui': UmbCommunityKeyValuesPropertyEditorUIElement;\r\n  }\r\n}\r\n"],"names":["_UmbCommunityKeyValuesPropertyEditorUIElement_instances","onAddRow_fn","onDelete_fn","updatePropertyEditorValue_fn","onValid_fn","onInvalid_fn","UmbCommunityKeyValuesPropertyEditorUIElement","UmbLitElement","__privateAdd","index","updatedItem","__privateMethod","_a","html","repeat","item","e","currentInputTyped","umbConfirmModal","UmbPropertyValueChangeEvent","event","css","__decorateClass","property","state","query","customElement"],"mappings":"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"}