{"version":3,"file":"key-values-property-editor-ui.element-DTydZhMH.js","sources":["../../../Client/src/propertyeditors/key-values-property-editor-ui.element.ts"],"sourcesContent":["import { LitElement, css, html, customElement, property, state, query, repeat } from \"@umbraco-cms/backoffice/external/lit\";\r\n//import { umbConfirmModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport { UmbPropertyValueChangeEvent } from \"@umbraco-cms/backoffice/property-editor\";\r\n\r\n/*\r\nThis is a work in progress\r\n\r\nWHAT WORKS NOW\r\n* You can add, delete and update items - the save and publish stores to the db and it loads.\r\n* I do check for a new property so that it works to add the first item\r\n\r\nTODO:\r\n1) I can't work out how I'd init _items (tried in the constructor but it's empty there?) as I'm unclear on how this.value is populated in the first place - I seem to declare it and it's magically assigned (perhaps in UmbPropertyEditorUiElement?)\r\n2) Sorter\r\n3) Check the key is unique and not null on add (perhaps a nice config option)\r\n4) Maybe a backend property type convertor. - if we use a key value pair then recheck items are unique - what to do if some junk duplicates are there?\r\n5) Style and tidy up\r\n6) Fix the constructor - init the _items?\r\n7) Use an umbraco confirm dialog - didn't seem to have the host / controller \r\n*/\r\n\r\n// todo - should these be here or inside the custom element\r\ntype UmbCommunityKeyValue = {\r\n  key: string;\r\n  value: string;\r\n};\r\ntype ArrayOf<T> = T[];\r\n\r\n@customElement('key-values-property-editor-ui')\r\nexport default class UmbCommunityKeyValuesPropertyEditorUIElement extends LitElement implements UmbPropertyEditorUiElement {\r\n\r\n  @property()\r\n  public value: ArrayOf<UmbCommunityKeyValue> = [];\r\n\r\n  @state()\r\n  private _items: ArrayOf<UmbCommunityKeyValue> = [];\r\n\r\n  @query('#key-value-new-key')\r\n  newNameInp!: HTMLInputElement;\r\n\r\n  @query('#key-value-new-value')\r\n  newValueInp!: HTMLInputElement;\r\n\r\n  //#host: UmbControllerHost;\r\n\r\n  // use the connectedCallback as suggested by Jacob Overgaard as this is where the this.value is available and assigned\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    // in connectedCallback the this.value is ready\r\n    this._items = this.value;\r\n  }\r\n\r\n  #onAddRow() {\r\n    const currentInputTyped: UmbCommunityKeyValue = {\r\n      key: this.newNameInp.value,\r\n      value: this.newValueInp.value\r\n    };\r\n\r\n    // check the value is an array, the concatenate o/w create an array with this as the first item\r\n    this._items = Array.isArray(this.value) ? [...this.value, currentInputTyped] : [currentInputTyped];\r\n\r\n    this.#updatePropertyEditorValue();\r\n  }\r\n\r\n  #onDelete(index: number) {\r\n    // todo - can't get the host to use the umbConfirmModal here - what should it be?\r\n    // await umbConfirmModal(this.#host, {\r\n    //   headline: `Delete ${this.value || 'item'}`,\r\n    //   content: 'Are you sure you want to delete this item?',\r\n    //   color: 'danger',\r\n    //   confirmLabel: 'Delete',\r\n    // });\r\n   \r\n    // hack use a confirm yes no dialog for now\r\n    if (confirm(\"Are you sure you want to delete this item?\")) {\r\n      this._items = [...this._items.slice(0, index), ...this._items.slice(index + 1)];\r\n      this.#updatePropertyEditorValue();\r\n    }\r\n  }\r\n\r\n  private _onEditRowValue(e: InputEvent, index: number) {\r\n    let currentItem = this._items[index];\r\n\r\n    const updatedItem: UmbCommunityKeyValue = {\r\n      key: currentItem.key,\r\n      value: (e.target as HTMLInputElement).value\r\n    };\r\n\r\n    this._items = [...this._items.slice(0, index), updatedItem, ...this._items.slice(index + 1)];\r\n\r\n    this.#updatePropertyEditorValue();\r\n  }\r\n\r\n  #updatePropertyEditorValue() {\r\n    this.value = this._items;\r\n    this.dispatchEvent(new UmbPropertyValueChangeEvent());\r\n  }\r\n\r\n  renderItemsList() {\r\n    // writes out the list with fields to update\r\n    if (this._items?.length) {\r\n      return html`\r\n      <ul>\r\n        ${repeat(this._items, (item) => item.key, (item, index) => html`\r\n            <li>\r\n              <input type=\"text\" name=\"${index}\" value=\"${item.key}\" disabled=\"disabled\"></input>\r\n              <input type=\"text\" name=\"${index}\" value=\"${item.value}\" @input=${(e: InputEvent) => this._onEditRowValue(e, index)}></input>\r\n              <uui-button\r\n\t\t\t\t\t\t    compact\r\n\t\t\t\t\t\t    color=\"danger\"\r\n\t\t\t\t\t\t    label=\"remove ${item.key}\"\r\n\t\t\t\t\t\t    look=\"outline\"\r\n\t\t\t\t\t\t    @click=${() => this.#onDelete(index)}>\r\n\t\t\t\t\t\t    <uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t    </uui-button>\r\n            </li> `\r\n      )\r\n        }\r\n      </ul>`;\r\n    } else {\r\n      return html`<span>You don't have any items yet</span>`;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n        ${this.renderItemsList()}\r\n            <span>Add a new item</span>\r\n            <uui-input\r\n                id=\"key-value-new-key\"\r\n                class=\"element\"\r\n                label=\"text input\"\r\n                value=\"\"\r\n            >\r\n            </uui-input>\r\n            <uui-input\r\n                id=\"key-value-new-value\"\r\n                class=\"element\"\r\n                label=\"text input\"\r\n                value=\"\"\r\n            >\r\n            </uui-input>\r\n            <div id=\"wrapper\">\r\n                <uui-button\r\n                    id=\"add-row-button\"\r\n                    class=\"element\"\r\n                    look=\"primary\"\r\n                    label=\"Add a row\"\r\n                    @click=${this.#onAddRow}\r\n                >\r\n                    Add a key value item\r\n                </uui-button>\r\n            </div>\r\n        `;\r\n  }\r\n\r\n  static styles = [\r\n    css`\r\n            #wrapper {\r\n                margin-top: 10px;\r\n                display: flex;\r\n                gap: 10px;\r\n            }\r\n            .element {\r\n                width: 100%;\r\n            }\r\n        `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'key-values-property-editor-ui': UmbCommunityKeyValuesPropertyEditorUIElement;\r\n  }\r\n}\r\n"],"names":["_UmbCommunityKeyValuesPropertyEditorUIElement_instances","onAddRow_fn","onDelete_fn","updatePropertyEditorValue_fn","UmbCommunityKeyValuesPropertyEditorUIElement","LitElement","__privateAdd","index","updatedItem","__privateMethod","_a","html","repeat","item","e","currentInputTyped","UmbPropertyValueChangeEvent","css","__decorateClass","property","state","query","customElement"],"mappings":"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"}